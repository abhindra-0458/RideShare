============================= test session starts =============================
platform win32 -- Python 3.11.9, pytest-7.4.3, pluggy-1.6.0
rootdir: C:\PROJECTS\RideShare\backend
configfile: pytest.ini
plugins: anyio-3.7.1, langsmith-0.6.3, asyncio-0.21.1, cov-4.1.0, mock-3.12.0
asyncio: mode=Mode.AUTO
collected 2 items

tests\test_auth.py 2026-01-22 21:41:17 - rideshare - INFO - POST /api/v1/auth/register
2026-01-22 21:41:17 - rideshare - INFO - POST /api/v1/auth/register
FAILED: 400 Invalid host header
F2026-01-22 21:41:18 - rideshare - INFO - POST /api/v1/auth/login
2026-01-22 21:41:18 - rideshare - INFO - POST /api/v1/auth/login
F

================================== FAILURES ===================================
_________________________ test_register_user_success __________________________

async_client = <httpx.AsyncClient object at 0x000002864616F950>
mock_user_service = <MagicMock name='UserService' id='2775723747984'>

    @pytest.mark.asyncio
    async def test_register_user_success(async_client: AsyncClient, mock_user_service):
        # Setup mock
        mock_user_service.register_user.return_value = {
            "id": "test-uuid",
            "email": "test@example.com",
            "first_name": "Test",
            "last_name": "User"
        }
    
        payload = {
            "email": "test@example.com",
            "password": "Password123!",
            "first_name": "Test",
            "last_name": "User",
            "phone": "+1234567890"
        }
    
        response = await async_client.post("/api/v1/auth/register", json=payload)
    
        if response.status_code != 201:
            print(f"FAILED: {response.status_code} {response.text}")
    
>       assert response.status_code == 201
E       assert 400 == 201
E        +  where 400 = <Response [400 Bad Request]>.status_code

tests\test_auth.py:28: AssertionError
------------------------------ Captured log call ------------------------------
INFO     rideshare:main.py:86 POST /api/v1/auth/register
___________________________ test_login_user_success ___________________________

async_client = <httpx.AsyncClient object at 0x00000286461BFD90>
mock_user_service = <MagicMock name='UserService' id='2775725586768'>

    @pytest.mark.asyncio
    async def test_login_user_success(async_client: AsyncClient, mock_user_service):
        # Setup mock
        mock_user_service.login_user.return_value = {
            "access_token": "valid_token",
            "refresh_token": "valid_refresh",
            "token_type": "bearer",
            "user": {
                "id": "test-uuid",
                "email": "test@example.com"
            }
        }
    
        payload = {
            "email": "test@example.com",
            "password": "Password123!"
        }
    
        response = await async_client.post("/api/v1/auth/login", json=payload)
    
>       assert response.status_code == 200
E       assert 400 == 200
E        +  where 400 = <Response [400 Bad Request]>.status_code

tests\test_auth.py:54: AssertionError
------------------------------ Captured log call ------------------------------
INFO     rideshare:main.py:86 POST /api/v1/auth/login
============================== warnings summary ===============================
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284
  C:\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\_internal\_config.py:284: PydanticDeprecatedSince20: Support for class-based `config` is deprecated, use ConfigDict instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.7/migration/
    warnings.warn(DEPRECATION_MESSAGE, DeprecationWarning)

..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\fields.py:770
..\..\..\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\fields.py:770
  C:\Users\abhin\AppData\Local\Programs\Python\Python311\Lib\site-packages\pydantic\fields.py:770: PydanticDeprecatedSince20: `min_items` is deprecated and will be removed, use `min_length` instead. Deprecated in Pydantic V2.0 to be removed in V3.0. See Pydantic V2 Migration Guide at https://errors.pydantic.dev/2.7/migration/
    warn('`min_items` is deprecated and will be removed, use `min_length` instead', DeprecationWarning)

routes\ride_routes.py:202
  C:\PROJECTS\RideShare\backend\routes\ride_routes.py:202: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    ride_type: str = Query("all", regex="^(all|created|joined)$"),

routes\ride_routes.py:207
  C:\PROJECTS\RideShare\backend\routes\ride_routes.py:207: DeprecationWarning: `regex` has been deprecated, please use `pattern` instead
    sort_order: str = Query("asc", regex="^(asc|desc)$"),

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ===========================
FAILED tests/test_auth.py::test_register_user_success - assert 400 == 201
FAILED tests/test_auth.py::test_login_user_success - assert 400 == 200
======================= 2 failed, 10 warnings in 0.42s ========================
